<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>使Python 2.x字符串编码的小结</title>
  <meta name="author" content="Alexandre Matos Martins" />
  <meta name="description" content="使Python 2.x字符串编码的小结" />
  <link href="/atom.xml" rel="alternate" title="" type="application/atom+xml" />
  <link rel="icon" href="/favicon.ico" type="image/x-icon"/>

  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="/css/jquery.metro.css" type="text/css" media="all" />
  <script src="/js/libs/jquery.min.js"></script>
  <script src="/js/libs/jquery.metro.js"></script>
  <script>
  $(function () {
      $("div.metro-pivot").metroPivot();
      });
  </script>
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/libs/modernizr-2.5.3-respond-1.1.0.min.js" type="text/javascript"></script>
</head>
<body>
  <div id="header-container">
    <header class="wrapper clearfix">
      <h1 id="title">黑化二次元研究笔记 (</h1>
      <nav>
        <ul>
          <li><a href="/" style="background: #199900">home</a></li>
          <li><a href="https://twitter.com/ling0322" style="background: #F5B401">twitter</a></li>
          <li><a href="https://github.com/ling0322" style="background: #AF1D00">github</a></li>
        </ul>
      </nav>
    </header>
  </div>

  <div id="main-container">
    <div id="main" class="wrapper clearfix">      
        <script type="text/javascript"
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
          tex2jax: {
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
          }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<link href="/css/prettify.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="/js/libs/prettify.js"></script>
<script type="text/javascript">
$(function () {
  $('pre').addClass("prettyprint");
  prettyPrint();
});
</script>

<article>
  <section>
  <h1>使Python 2.x字符串编码的小结</h1>
  <p>如果你 经常遇到这种错误提示的信息: UnicodeEncodeError: ‘ascii’ codec can’t encode characters in position 0-1: ordinal not in range(128), 或者杯具的发现明明在Eclipse中写的程序能够正常运行然后到了终端下面就跳出以上的一段话. 那么, 就证明你和我一样, 遇到了悲催的Python的编码问题了.</p>

<p>之前在用Python语言写我的毕业设计, 然后各种没有问题, 直到整个东西完成了, 突发奇想想去试一下对中文的支持. 然后你懂的, 就弹出了以上一串恶心的错误提示, 然后改半天, 各种改, 各种错误, 然后各种想砸键盘. 其实之前的一篇日志中也说到了, 解决这一类的问题最好的方法就是在程序开头加上以下几行代码:</p>

<pre><code>import sys
reload(sys)
sys.setdefaultencoding(“utf-8″)
</code></pre>

<p>那么就可助你解决几乎95%的这种问题, 但是如果想刨根问底的话, 就需要去了解很多东西了.</p>

<p>首先, 这个就是Python语言本身的问题. 因为在Python 2.x的语法中, 默认的str并不是真正意义上我们理解的字符串, 而是一个byte数组, 或者可以理解成一个纯ascii码字符组成的字符串, 与Python 3中的bytes类型的变量对应; 而真正意义上通用的字符串则是unicode类型的变量, 它则与Python 3中的str变量对应. 本来应该用作byte数组的类型, 却被用来做字符串用, 这种看似奇葩的设定是Python 2一直被人诟病的东西, 不过也没有办法, 为了与之前的程序保持兼容.</p>

<p>在Python 2中作为两种字符串类型, str与unicode之间就需要各种转换的方式. 首先是一种显式转换的方式, 就是encode和decode两种方法. 在这里这两货的意思很容易被搞反, 科学的调用方式是:</p>

<blockquote><p>str --- decode方法 ---> unicode<br/>
unicode --- encode方法 ---> str</p></blockquote>

<p>比如:</p>

<pre><code>&gt;&gt;&gt; type('x')
&lt;type 'str'&gt;
&gt;&gt;&gt; type('x'.decode('utf-8'))
&lt;type 'unicode'&gt;
&gt;&gt;&gt; type(u'x'.encode('utf-8'))
&lt;type 'str'&gt;
</code></pre>

<p>这个逻辑是这样的, 对于unicode字符串使用utf-8编码进行编码, 即调用encode('utf-8')方法生成byte数组类型的结果. 相反对于byte数组进行解码, 生成unicode字符串. 这个新手表示理解不能, 不过熟悉了就见怪不怪了.</p>

<p>另外是隐式的转换, 和C语言中的int转double类似, 当一个unicode字符串和一个str字符串进行连接的时候会默认自动将str字符串转换成unicode类型然后再连接. 而这个时候使用的编码方式则是系统所默认的编码方式. 使用:</p>

<pre><code>import sys
print sys.getdefaultencoding()
</code></pre>

<p>可以得到当前默认的编码方式, 是不是'ascii'? 是的话就恭喜你中彩了~!! 在这个时候如果有以下一行代码就保证会出错:</p>

<pre><code>&gt;&gt;&gt; x = u'喵'
&gt;&gt;&gt; x
u'\u55b5'
&gt;&gt;&gt; y = x.encode('utf-8')
&gt;&gt;&gt; x + y
</code></pre>

<blockquote><p>Traceback (most recent call last):<br/>
File "<stdin>", line 1, in <module><br/>
UnicodeDecodeError: 'ascii' codec can't decode byte 0xe5 in position 0: ordinal not in range(128)</p></blockquote>

<p>x是unicode类型的变量, y是x经过encode后的结果是str类型的变量. x + y的时候, 首先要将y转换成unicode字符串, 那么使用什么编码格式转换呢, 用utf-8还是gb2312或者还是utf-16? 这个时候就要根据sys.getdefaultencoding()来确定, 而sys.getdefaultencoding()是'ascii'编码, 在ascii字符表中不存在0xe5这种大于128的字符存在, 所以当然报错啦! 通过加入</p>

<pre><code>import sys
reload(sys)
sys.setdefaultencoding(“utf-8″)
</code></pre>

<p>则可以将默认的编码转换格式变成utf-8, 且大多数情况下, 程序中的字符串是通过utf-8来编码的, 所以只要加上以上三行就可以了.</p>

<p>但是有没有觉得, 加上这些会使得代码有些dirty? 咳, 至少对于我来说确实很dirty. 所以我觉得平时写程序的过程中要养成尽量使用显示的转换的习惯, 并且要明确某个函数返回的到底是str还是unicode, 凡是str的主动decode成unicode, 不要将两者混淆掉, 这样写出来的代码才比较干净. 此外还可以在代码最上方加入'from <strong>future</strong> import unicode_literals'可以默认将用户自定义字符串变成unicode类型.</p>

<p>最后我想大吼一声Python 2.x中str不是字符串, 而是B♂Y♂T♂E♂数♂组~!!</p>

  </section>
  <footer>
  </footer>
</article>

<aside>
  <h4>26 Jun 2012</h4>
  <span><a href="/tags/Python.html">#Python</a> &nbsp;</span>
  <h3>Recent Posts</h3>
  
    <a href="/2013/05/07/recommander-system.html">使用矩阵分解做推荐系统</a> <br>
  
    <a href="/2013/02/13/cws-intro.html">关于分词以及常用软件的简单介绍</a> <br>
  
    <a href="/2012/08/26/hmm-pinyin.html">使用韩梅梅(HMM)模型(又称隐马模型)解决拼音输入的纠错问题</a> <br>
  
    <a href="/2012/06/26/python-encoding.html">使Python 2.x字符串编码的小结</a> <br>
  
    <a href="/2012/02/11/linux-font-aa.html">Linux下Simsun字体英文关AA的设置</a> <br>
  
  <h3>Tags</h3>
   &nbsp;&nbsp;<a href="/tags/Font.html" title="Posts tagged Font" style="font-size: 16.2px; line-height:16.2px">Font</a> &nbsp;&nbsp;<a href="/tags/Google.html" title="Posts tagged Google" style="font-size: 16.2px; line-height:16.2px">Google</a> &nbsp;&nbsp;<a href="/tags/HMM.html" title="Posts tagged HMM" style="font-size: 16.2px; line-height:16.2px">HMM</a> &nbsp;&nbsp;<a href="/tags/Hello World.html" title="Posts tagged Hello World" style="font-size: 16.2px; line-height:16.2px">Hello World</a> &nbsp;&nbsp;<a href="/tags/Machine Learning.html" title="Posts tagged Machine Learning" style="font-size: 17.4px; line-height:17.4px">Machine Learning</a> &nbsp;&nbsp;<a href="/tags/MapReduce.html" title="Posts tagged MapReduce" style="font-size: 16.2px; line-height:16.2px">MapReduce</a> &nbsp;&nbsp;<a href="/tags/NLP.html" title="Posts tagged NLP" style="font-size: 16.2px; line-height:16.2px">NLP</a> &nbsp;&nbsp;<a href="/tags/Python.html" title="Posts tagged Python" style="font-size: 16.2px; line-height:16.2px">Python</a> &nbsp;&nbsp;<a href="/tags/中文分词.html" title="Posts tagged 中文分词" style="font-size: 16.2px; line-height:16.2px">中文分词</a> &nbsp;&nbsp;<a href="/tags/云计算.html" title="Posts tagged 云计算" style="font-size: 16.2px; line-height:16.2px">云计算</a> &nbsp;&nbsp;<a href="/tags/推荐系统.html" title="Posts tagged 推荐系统" style="font-size: 16.2px; line-height:16.2px">推荐系统</a>

</aside>


     
    </div> <!-- #main -->
  </div> <!-- #main-container -->

<div id="about-container">
  <div class="wrapper">

    <div id="side" class="clearfix">
    </div>
            
    <article>
    <h2>About</h2>
    <strong>@ling0322 (Louis Chen)</strong></br>
    <span>Python / NLP / Machine Learning / Go</span><br />
    <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/cn/"><img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/2.5/cn/88x31.png" /></a></span><br />
    <span>本作品采用知识共享署名-非商业性使用-相同方式共享 2.5 中国大陆许可协议进行许可</span><br />
    <span>* This template is from <a href="http://al3xandr3.github.io/">http://al3xandr3.github.io/</a></span>
    </article>

  </div> <!-- wrapper -->
</div> <!-- about-container -->




<!-- Metro Pivot -->

</body>
</html>
